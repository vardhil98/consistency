<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Habit Tracker</title>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  .calendar-day {
      border-radius: 6px;
      padding: 10px;
      margin: 2px;
      text-align: center;
      cursor: pointer;
      transition: 0.2s;
      background-color: #f0f8ff;
  }
  .calendar-day:hover {
      background-color: #b3e5fc;
  }
  .calendar-day.selected {
      background-color: #4caf50;
      color: white;
      font-weight: bold;
  }
  .day-name {
      font-weight: bold;
      text-align: center;
      padding: 10px;
  }
  .disabled-day {
      background-color: #e0e0e0 !important;
      color: #888 !important;
      cursor: not-allowed !important;
  }
  .reward-container {
      display: none;
  }
</style>
</head>
<body class="bg-light">

<div class="container my-4">
    <div class="card shadow-sm">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
                <div class="btn-group mb-2">
                    <button id="prevYear" class="btn btn-primary">&laquo;</button>
                    <button id="prevMonth" class="btn btn-primary">&lsaquo;</button>
                </div>
                <h4 id="monthYear" class="mb-2 text-center flex-grow-1"></h4>
                <div class="btn-group mb-2">
                    <button id="nextMonth" class="btn btn-primary">&rsaquo;</button>
                    <button id="nextYear" class="btn btn-primary">&raquo;</button>
                </div>
            </div>

            <div class="row text-center fw-bold" id="dayNames"></div>
            <div class="row text-center" id="calendar"></div>

            <div class="d-flex justify-content-center mt-3">
                <button id="breakBtn" class="btn btn-danger">Break Consistency</button>
            </div>

            <div class="reward-container mt-3 p-3 bg-warning rounded text-center" id="rewardContainer">
                ðŸŽ‰ You earned a reward! ðŸŽ‰<br>
                <button id="useRewardBtn" class="btn btn-success mt-2">Use Reward</button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const calendarEl = document.getElementById('calendar');
const dayNamesEl = document.getElementById('dayNames');
const monthYearEl = document.getElementById('monthYear');
const prevMonthBtn = document.getElementById('prevMonth');
const nextMonthBtn = document.getElementById('nextMonth');
const prevYearBtn = document.getElementById('prevYear');
const nextYearBtn = document.getElementById('nextYear');
const breakBtn = document.getElementById('breakBtn');
const rewardContainer = document.getElementById('rewardContainer');
const useRewardBtn = document.getElementById('useRewardBtn');

let selectedDates = JSON.parse(localStorage.getItem('selectedDates')) || [];
let rewardEarned = JSON.parse(localStorage.getItem('rewardEarned')) || false;
let today = new Date();
let currentMonth = today.getMonth();
let currentYear = today.getFullYear();
const dayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

function getSortedDates(){
    return selectedDates.map(d => new Date(d)).sort((a,b)=>a-b);
}

// Check for streaks of 10 consecutive days
function checkReward() {
    const sortedDates = getSortedDates();
    let streak = 1;
    let earned = rewardEarned || false;

    for(let i=1;i<sortedDates.length;i++){
        const diff = (sortedDates[i]-sortedDates[i-1])/(1000*60*60*24);
        if(diff === 1){
            streak++;
            if(streak >= 10 && !earned){
                earned = true;
                rewardEarned = true;
                localStorage.setItem('rewardEarned', JSON.stringify(true));
            }
        } else {
            streak = 1; // streak broken
        }
    }

    // Hide reward if no streak >=10
    let hasStreak10 = false;
    for(let i=0;i<sortedDates.length;i++){
        let count=1;
        for(let j=i+1;j<sortedDates.length;j++){
            const diff = (sortedDates[j]-sortedDates[j-1])/(1000*60*60*24);
            if(diff === 1) count++; else break;
        }
        if(count>=10) { hasStreak10 = true; break; }
    }

    if(!hasStreak10){
        earned = false;
        rewardEarned = false;
        localStorage.setItem('rewardEarned', JSON.stringify(false));
    }

    rewardContainer.style.display = earned ? 'block' : 'none';
}

function renderCalendar(month, year) {
    calendarEl.innerHTML = '';
    dayNamesEl.innerHTML = '';

    monthYearEl.textContent = `${new Date(year, month).toLocaleString('default', { month: 'long' })} ${year}`;

    // Day names row
    dayNames.forEach(d=>{
        const div = document.createElement('div');
        div.className = 'col border day-name';
        div.textContent = d;
        dayNamesEl.appendChild(div);
    });

    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month+1, 0).getDate();
    const totalCells = firstDay + daysInMonth;
    const rows = Math.ceil(totalCells/7);

    let dayCounter = 1;
    for(let r=0;r<rows;r++){
        const row = document.createElement('div');
        row.className = 'row mb-1';
        for(let c=0;c<7;c++){
            const col = document.createElement('div');
            col.className = 'col p-1';

            if(r===0 && c<firstDay){
                col.innerHTML = '';
            } else if(dayCounter <= daysInMonth){
                col.innerHTML = `<div class="calendar-day">${dayCounter}</div>`;
                const dayEl = col.firstChild;
                const dateStr = `${year}-${month+1}-${dayCounter}`;
                const dateObj = new Date(year, month, dayCounter);

                if(dateObj > new Date()){
                    dayEl.classList.add('disabled-day');
                } else {
                    if(selectedDates.includes(dateStr)) dayEl.classList.add('selected');
                    dayEl.addEventListener('click', ()=>{
                        if(selectedDates.includes(dateStr)){
                            selectedDates = selectedDates.filter(d=>d!==dateStr);
                            dayEl.classList.remove('selected');
                        } else {
                            selectedDates.push(dateStr);
                            dayEl.classList.add('selected');
                        }
                        localStorage.setItem('selectedDates', JSON.stringify(selectedDates));
                        checkReward();
                    });
                }
                dayCounter++;
            }
            row.appendChild(col);
        }
        calendarEl.appendChild(row);
    }
}

prevMonthBtn.addEventListener('click', ()=>{
    currentMonth--;
    if(currentMonth<0){ currentMonth=11; currentYear--; }
    renderCalendar(currentMonth, currentYear);
});
nextMonthBtn.addEventListener('click', ()=>{
    currentMonth++;
    if(currentMonth>11){ currentMonth=0; currentYear++; }
    renderCalendar(currentMonth, currentYear);
});
prevYearBtn.addEventListener('click', ()=>{
    currentYear--;
    renderCalendar(currentMonth, currentYear);
});
nextYearBtn.addEventListener('click', ()=>{
    currentYear++;
    renderCalendar(currentMonth, currentYear);
});

breakBtn.addEventListener('click', ()=>{
    selectedDates = [];
    localStorage.removeItem('selectedDates');
    rewardEarned = false;
    localStorage.setItem('rewardEarned', JSON.stringify(false));
    renderCalendar(currentMonth, currentYear);
    checkReward();
});

useRewardBtn.addEventListener('click', ()=>{
    rewardEarned = false;
    localStorage.setItem('rewardEarned', JSON.stringify(false));
    rewardContainer.style.display = 'none';
});

renderCalendar(currentMonth, currentYear);
checkReward();
</script>

</body>
</html>
